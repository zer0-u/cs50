# week7 SQL

## 0306

### 講義動画
- TV番組の名前とジャンルのアンケートを取ったらしい
  - ジャンルは複数選べる
  - ジャンルは1つの列にカンマ区切りで収められている
- 結果を使っていろいろな分析をしてみたい
- スプレッドシートが得意なこと
  - 検索やソートが素早い
  - 大量のデータを保存できる(限度はある)
- スプレッドシートは行と列でデータを保存する
- データを追加する時は行が増える
- 列は属性やフィールド(保存するデータの種類)を表す
  - フォームやシートを作る時に考えるべきこと
  - 列はあまり増えない
- データのレイアウトやスキーマ(構造)は事前に決めておくのが一般的
- CSVファイルはフラットファイルデータベースと呼ばれる
- データベース＝データを保存するファイルやプログラムのこと
- カンマの代わりに違う区切り文字を使っても良い
- データの中にカンマがあると混乱を起こしやすい
  - 含めたい時はデータをダブルクォートで挟むとよい
  - 区切り文字としてのカンマとそうでないものを分ける
- フラットファイルデータベースでは数式を扱えない
- 回答結果をCSVとしてダウンロードしてCS50 IDEにアップロードする
- Pythonを使って分析してみる(favorites.py)
  - 実行はできないが一応実装してみる
- やりたいことは小さく分けて実装する
- open関数の第2引数(モード)のデフォルト値はr(読み込み)
  - →読み込みの場合は第2引数がなくても動く
- DictReaderはpythonに組み込まれたもの
  - 最初の行をカンマで分割し、それぞれの値が列名だと「仮定」している
  - 1行目にヘッダがないとうまく動作しない
- タイトルの重複をなくしたい
- 方法1：setを使う
  - addメソッドで追加
  - forループで取り出し(setはイテレータを保持している)
- setの中身をソートする
  - sorted関数に渡せば自動的にソートしてくれる
- 表記ゆれまではカバーできない
  - 大文字・小文字を揃える＝正規化(なんらかのルールに従って標準化すること)
  - upper()メソッドを呼び出す
- 多少はまとまったがまだ重複している
  - 末尾のスペースの有無が差を生んでいるっぽい
  - stripメソッドで取り除く(先頭と末尾の空白文字を削除)
- これ以上の正規化はとても手間がかかる
  - typoの検知・修正など
  - これが現実
- 今日はここまで(30:55)

## 0308

### 講義動画
- 一昨日見ていたものと違う気がする
- 6日は2020版・8日は2021版
  - 困ったことになった
  - 新しいものの方がいいだろうし改めて2021版を見ることにした
  - 冒頭は倍速で
  - 6日に実装したものは2020フォルダへ移動した
- この回のポイントはデータの永続化
  - プログラムが終了してもデータを残す方法
- CSVとエクセルの違い
  - テキストファイルだが規則を持っている
  - フラットファイルデータベース
  - CSVは完全にポータブル
- 一番人気のある番組を調べたい
- DictReaderは単純なreaderより堅牢性が高い
- 重複のフィルタリング
- ますはlistを用いる
  - favorites0.py
- 入力値から不要な空白を取り除く
- すべて大文字に変換する
- pythonはメソッドチェーンが書けるので便利
- 結構違う流れなので結局等速で見ている
- データの外見を標準化＝正規化している
- python2を使っているらしい？
- listをsetに置き換える(favorites2.py)
  - setの省略記法的なものはないのかな
  - {}だった
- sortedでタイトル一覧をソートする
- これ以上の正規化はとてもむずかしい
- タイトルを入力した人数を数える
  - ここで実装していない差分については無視する
  - 「Brooklyn-99」と「Brooklyn 99」とか
- dictを使ってタイトル(title)と回数(count)を紐づけたい
  - favorites3.py
- dictとsetは省略記法が同じ{}
  - 中身の書き方で差別化するらしい
- titles[title]+=1で数を記録する？
- 実行するとエラーが発生する
  - KeyError(存在しない要素を参照しようとしている)
- 回数を増やす前に存在チェックを挟む
  - 存在すれば1増やす、しなければ0と紐づける
- dictをforで回すとキー名しか参照されない
  - print(title, titles[title]) で回数も表示される
- 存在チェックでfalseだった場合は0ではなく1で初期化すべきだった
  - あるいは0で初期化し、1増やす処理を常に行う
  - どちらの方法でも良い
  - 重要なのは事前にチェックすること
- dictのソート(sorted(dictオブジェクト))はキーによって行われる
- 値(登場回数)でソートしたい
- sorted関数には複数の引数を渡せる
  - 例 reverse=Trueで逆順
- 値でソートしたい時はソート用の関数を用意する
  - get_value関数
- sorted関数のkey引数にキー(を取得する関数そのもの)を渡す
- reverse=Trueは数値だと大きい順を意味する
- THE OFFICEってどんな番組なんだろう
- favorites3.pyをもっと短くしたい
- 引数keyにget_value関数ではなくラムダ関数を渡す
  - lambda 引数:戻り値
  - 再利用しないと分かっている関数を用意したい時に便利
- ラムダは1行だけの関数に使う
  - 基本的にすぐreturnされるとみなす(returnは書かない)
  - 難しい処理も盛り込めるが推奨されない
- 今回はここまで(36:14)

## 0309

### 講義動画(36:15)
- 1つのタイトルに注目する(favorites4.py)
- 「The Office」のつもりで「Office」と投稿した人がいたらもちろん総数は減る
  - 両方カウントするにはどうしたらいいか
- orで条件を複雑にする
- "OFFICE" in title ともできる
  - title(文字列)に「OFFICE」が含まれたら
- 「thevoffice」があることが分かった
- 「THE OFFICE」と「OFFICE」が同じものってどうして分かるんだろう？
  - テレビ番組はよくわからない
- 正規表現
- Googleフォームは回答の検証ができる
  - 検証に正規表現も使える