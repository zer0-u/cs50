# 0414

## 講義動画
- これまで学んできた言語を組み合わせる
- まだAndroidがKotlinじゃなくてJavaの時代らしい
  - 2021年なのに？
  - KotlinもJavaに含めているのかな
- http-serverは無償なのでちょっと機能が弱い
  - クライアントサイドに完結した処理はできるがサーバサイドとの連携はできない
  - 別のツールを後ほど紹介する
- ルーティング
  - 特定のフォルダやサイトを参照しないURLのあり方
- 先週までのツールではクエリパラメータを解析できなかった
  - 追加できても読み取れない
- pythonで構築されたWebサーバを使うとパスパラメータが使えるようになる
  - dictオブジェクトに変換してくれる
- フレームワークを使う
  - 誰かが書いたライブラリの束
  - 物事を行うための一連の規則
  - bootstrapもフレームワークの一種
- flaskはpythonのフレームワーク
  - パスパラメータ解析やメール送信などが簡単にできる
- flaskを利用する
  - from flask import Flask
- flaskの規則
  - ルートディレクトリにapp.py, requirements.txt, staticディレクトリ, templatesディレクトリが必要
  - requirements.txtは参照したいライブラリの名前を列挙したテキストファイル
  - staticディレクトリには画像やCSSなど静的コンテンツを入れる
  - templatesディレクトリはHTMLを入れる
  - これはflaskの慣習
    - フレームワークが変われば慣習も変わる

## 講義動画(8:47)
- Webアプリケーションを作ってみる(helloフォルダ)
- pythonのコメントは `//` でなく#だと忘れていた
- app.py→index.html
- 静的ファイルがないのでstaticsは不要
- requirements.txtはシンプルなものでいいと言っているが具体的な手順は不明
- 起動する
  - http-serverはapp.pyの中身をそのまま表示する
  - flask runで実行(必要なものは事前のインストール済)
- requrements.txtは今のところつくらなくていいらしい
- flaskはデフォルトでポート5000を使う
- URLの末尾に「/?name=david」を足してみる
  - /はChromeによって省略されたものを補完している
- davidを取れるようにしたい
  - request.args.getを使う
- 今日はここまで(18:00)

# 0415

## 講義動画(19:00)
- render_templateの使い方について補足
  - テンプレートで参照する用の変数名=python内の値(変数も可)
- URLを直接いじる形式はやめたい
  - テキストボックス等に入力された値をURLに含めたい
- hello1フォルダ
- form要素のactionでsubmit時のURLを指定できる
  - ルートURL/greet?name=入力値 に移動する(現時点では404)
- /greetにアクセスしたらgreet.htmlを返すよう、greet関数を実装する
  - HTMLファイルはまだ用意されていない
- この時点でsubmitすると500になる(greet.htmlがないので)
- ターミナルにはスタックトレースが表示されている
  - jinja2.exceptions.TemplateNotFound: greet.html
- greet.htmlを作ったら正常に動作した
- nameが空欄のままsubmitするつ「hello,」としか表示されない
  - request.args.get("パラメータ名", デフォルト値) が使える
  - パラメータが無い時にデフォルト値が代入される
  - キーがある場合は何も起こらない
    - 空文字が代入されているとみなされている
- input要素にrequiredをつけて解決した
  - クライアントサイドの入力チェックは信頼できない
  - Devtoolから改変してすり抜けられるので
- index.htmlとgreet.htmlには問題がある
  - 一部が共通している(doctype,html,head等)
  - ファイルが増えると変更の手間も増える
  - 共通点をくくり出したい

## 動画 レイアウト共通化(34:25)
- hello2フォルダ
- templatesフォルダにlayout.htmlを作ってindex.htmlの内容をコピペ
- index.htmlとgreet.htmlは大幅に書き換える
- {% %}でブロックを定義する
- {{}}や{% %}はJinja構文と呼ぶ
  - FlaskはJinja構文を借りている
- app.pyは変更なし
- 実行したら503になってしまった
  - 再実行で問題なく動作
- devtoolで参照するとjinja構文が解消されて完全なHTMLになっていることが分かる
- デザインのよさ(保守しやすさ)とメモリ効率の両方を意識した書き方

## 動画 セキュリティの問題(41:00頃)
- URLから入力値が推測できてしまうのはよくない
  - 名前はともかくパスワード等は漏らしたくない
- index.htmlのform要素のmethod属性をgetからpostに変更するとURLの末尾には載らない
- submitで405(method not allowed)が起きる
- @app.routeの第2引数でメソッドを指定してやる
- 405は解消した
- POSTリクエストのデメリット
  - 履歴やオートコンプリートの有用性が下がる
  - リロード時に不要な更新が行われてしまう可能性がある
  - ブックマークができない
- GETとPOSTはそれぞれ適切に使い分ける必要がある
- 今日はここまで(46:50)

# 0417

## 動画 46:52
- POSTリクエストにしたら名前が取れなくなった
- request.formでリクエストボディを参照できる
  - 使い方はrequest.argsとほぼ同じ
- /greetページを更新するとPOSTリクエストが再送される→正しい結果が表示される
- FlaskはMVCに基づいたフレームワーク
  - app.pyはコントローラに相当する
  - htmlファイルはビューテンプレート(ユーザーインターフェース)
  - 現時点ではモデルがない(CSVやDBを指すことが多い)
- 新たなアプリケーションを作るので現在のコマンドは停止する

## 動画 FroshIMS 50:44
- 下準備
  - app.py
  - templates/layout.html(hello2からコピー)
    - titleタグの中身だけ変えておく
- 学生が学内スポーツに参加するための登録作業を行うらしい
  - 以前は紙で管理していた
- index.htmlもとりあえず用意する
- ファイルを変更するたびにflask runをやり直しているがこれは意味があるんだろうか？
  - こちらの手元ではちゃんと変更が反映されている
  - pset9で再起動を自動化する方法を紹介するらしい
- optionタグにdisabledとselectedをつけるとドロップボックスに簡易的な説明を追加できる
- registerボタンを押した後の処理を実装する
  - まずは入力値チェック